SELECT
  resourceId,
  SUBSTRING(resourceId, 1, 8) AS accountId,
  configuration.instanceId,
  configuration.instanceType,
  configuration.availabilityZone,
  configuration.imageId,  -- Assuming IMDSv2 is used for metadata
  configuration.instanceState.name,
  (
    SELECT configuration
    FROM 
      (
        SELECT configuration.volumeId, configuration.size, configuration.encrypted
        FROM AWS::EC2::Volume
        WHERE resourceId = instances.resourceId
      ) AS volumes
  ) AS volumeInfo
WHERE
  resourceType = 'AWS::EC2::Instance'
